import{g as $,r as E,j as i,L}from"./app-B8ZsLC9p.js";import{P as C}from"./PrimaryButton-DSShvtQM.js";import{T as W}from"./TextInput-yvwzq-GI.js";import{I as R}from"./InputLabel-SoisnjJg.js";import{A as U}from"./AuthenticatedLayout-4_Uwwc3b.js";import"./ApplicationLogo-CtfcIJ_W.js";import"./transition-WOU9ENOb.js";var f={},u={},P;function z(){if(P)return u;P=1,Object.defineProperty(u,"__esModule",{value:!0}),u.default=u.validSendMessageOptions=u.validRefreshAuthenticationTokenOptions=u.validLoginOptions=u.validEnvironment=void 0;const r=e=>{if(e&&(typeof e!="string"||!["dev","staging","prod"].includes(e)))throw Error("environment is invalid")};u.validEnvironment=r;const o=e=>{if(!e)throw Error("loginOptions are not defined!");if(e.scopes){if(!Array.isArray(e.scopes))throw Error(`scopes are type of ${typeof e.scopes} instead of Array`)}else throw Error("scopes are not defined!");if(e.clientId){if(typeof e.clientId!="string")throw Error(`clientId is type of ${typeof e.clientId} instead of string`)}else throw Error("clientId is not defined!")};u.validLoginOptions=o;const n=e=>{if(!e)throw Error("refreshAuthenticationTokenOptions are not defined!");if(e.clientId){if(typeof e.clientId!="string")throw Error(`clientId is type of ${typeof e.clientId} instead of string`)}else throw Error("clientId is not defined!");if(e.refreshToken){if(typeof e.refreshToken!="string")throw Error(`refreshToken is type of ${typeof e.refreshToken} instead of string`)}else throw Error("refreshToken is not defined!")};u.validRefreshAuthenticationTokenOptions=n;const t=e=>{if(!e)throw Error("sendMessageOptions are not defined!");if(e.message){if(typeof e.message!="string")throw Error(`message is type of ${typeof e.message} instead of string`)}else throw Error("message is not defined!");if(e.accessToken){if(typeof e.accessToken!="string")throw Error(`accessToken is type of ${typeof e.accessToken} instead of string`)}else throw Error("accessToken is not defined!");if(e.userIdentifier){if(typeof e.userIdentifier!="string")throw Error(`userIdentifier is type of ${typeof e.userIdentifier} instead of string`)}else throw Error("userIdentifier is not defined!")};u.validSendMessageOptions=t;var a={validEnvironment:r,validLoginOptions:o,validRefreshAuthenticationTokenOptions:n,validSendMessageOptions:t};return u.default=a,u}var w={},h={},T;function j(){if(T)return h;T=1,Object.defineProperty(h,"__esModule",{value:!0}),h.default=h.kingsChatApiPaths=h.allowedResponseOrigins=h.authorizationURLs=void 0;const r={dev:"http://localhost:5050",staging:"https://accounts.staging.kingsch.at",prod:"https://accounts.kingsch.at"};h.authorizationURLs=r;const o=["http://localhost:5050","https://accounts.staging.kingsch.at","https://accounts.kingsch.at"];h.allowedResponseOrigins=o;const n={dev:"http://localhost:8000",staging:"https://kc-connect.appunite.com",prod:"https://connect.kingsch.at"};h.kingsChatApiPaths=n;var t={authorizationURLs:r,allowedResponseOrigins:o,kingsChatApiPaths:n};return h.default=t,h}var v={},S;function D(){if(S)return v;S=1,Object.defineProperty(v,"__esModule",{value:!0}),v.default=v.parseScopesArrayToString=void 0;const r=n=>{if(n)if(Array.isArray(n)){let t="[";return n.forEach((a,e)=>{if(typeof a!="string")throw Error(`scope ${a}, at index ${e} is not string!`);e!==0&&(t+=", "),t+=`"${a}"`}),t+="]",t}else throw Error(`scopes is type of ${typeof n} instead of Array`);else throw Error("scopes array is not defined!")};v.parseScopesArrayToString=r;var o={parseScopesArrayToString:r};return v.default=o,v}var I;function F(){if(I)return w;I=1,Object.defineProperty(w,"__esModule",{value:!0}),w.default=w.loginWindow=void 0;var r=j(),o=D();function n(){if(!window)throw Error("No window defined");const s={width:Math.min(Math.floor(window.outerWidth*.9),950),height:Math.min(Math.floor(window.outerHeight*.9),600)};return s.left=Math.floor(window.screenX+(window.outerWidth-s.width)/2),s.top=Math.floor(window.screenY+(window.outerHeight-s.height)/8),`toolbar=0,scrollbars=1,status=1,resizable=1,location=1,menuBar=0,
    width=${s.width},height=${s.height},
    left=${s.left},top=${s.top}`}function t({myUrl:s,options:p}){const c=new URL(s.href);return c.searchParams.append("client_id",p.clientId||""),c.searchParams.append("scopes",(0,o.parseScopesArrayToString)(p.scopes)),c.searchParams.append("redirect_uri",window.location.origin),c.searchParams.append("post_message","1"),c}const a=(s,p)=>{const c=n(),l=t({myUrl:s,options:p}),d=window.open(l.href,"_blank",c);return d?new Promise((g,k)=>{const m=b=>{b.source!==window&&(r.allowedResponseOrigins.includes(b.origin)||(d.close(),k(Error("Not allowed message origin"))),b.data?(d.close(),b.data.error?k(Error(b.data.error)):g(b.data)):k(Error("Bad Request")))};window.addEventListener("message",m,!1);const x=setInterval(()=>{d.window||(window.removeEventListener("message",m,!1),clearInterval(x),k(Error("User closed window before allowing access")))},350)}):Promise.reject(Error("You have to enable popups to show login window"))};w.loginWindow=a;var e={loginWindow:a};return w.default=e,w}var y={},q;function O(){if(q)return y;q=1,Object.defineProperty(y,"__esModule",{value:!0}),y.default=y.refreshAuthenticationTokenRequest=void 0;var r=j();const o=({refreshAuthenticationTokenOptions:t,environment:a="prod"})=>fetch(`${r.kingsChatApiPaths[a]}/oauth2/token`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({client_id:t.clientId,grant_type:"refresh_token",refresh_token:t.refreshToken})}).then(e=>e.ok?e.json().then(s=>({accessToken:s.access_token,expiresInMillis:s.expires_in_millis,refreshToken:s.refresh_token})):Promise.reject(Error("error"))).catch(e=>Promise.reject(Error(e.message)));y.refreshAuthenticationTokenRequest=o;var n={refreshAuthenticationTokenRequest:o};return y.default=n,y}var _={},A;function B(){if(A)return _;A=1,Object.defineProperty(_,"__esModule",{value:!0}),_.default=_.sendMessageRequest=void 0;var r=j();const o=({sendMessageOptions:t,environment:a="prod"})=>fetch(`${r.kingsChatApiPaths[a]}/api/users/${t.userIdentifier}/new_message`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${t.accessToken}`},body:JSON.stringify({message:{body:{text:{body:t.message}}}})}).then(e=>e.ok?e.json():Promise.reject(Error("error"))).catch(e=>Promise.reject(Error(e.message)));_.sendMessageRequest=o;var n={sendMessageRequest:o};return _.default=n,_}var M;function H(){if(M)return f;M=1,Object.defineProperty(f,"__esModule",{value:!0}),f.default=f.sendMessage=f.refreshAuthenticationToken=f.login=void 0;var r=z(),o=F(),n=O(),t=B(),a=j();const e=(l,d)=>{try{return(0,r.validEnvironment)(d),(0,r.validLoginOptions)(l),(0,o.loginWindow)(new URL(a.authorizationURLs[d||"prod"]),l)}catch(g){return Promise.reject(g)}};f.login=e;const s=(l,d)=>{try{return(0,r.validEnvironment)(d),(0,r.validRefreshAuthenticationTokenOptions)(l),(0,n.refreshAuthenticationTokenRequest)({refreshAuthenticationTokenOptions:l,environment:d||"prod"})}catch(g){return Promise.reject(g)}};f.refreshAuthenticationToken=s;const p=(l,d)=>{try{return(0,r.validEnvironment)(d),(0,r.validSendMessageOptions)(l),(0,t.sendMessageRequest)({sendMessageOptions:l,environment:d||"prod"})}catch(g){return Promise.reject(g)}};f.sendMessage=p;var c={login:e,refreshAuthenticationToken:s,sendMessage:p};return f.default=c,f}var K=H();const N=$(K),J=({loginData:r,loginWithKingsChat:o})=>{const[n,t]=E.useState(""),[a,e]=E.useState(""),[s,p]=E.useState(!1),[c,l]=E.useState({type:"",message:""}),[d,g]=E.useState(null);console.log(r);const k=m=>{if(!r){o();return}m.preventDefault(),p(!0),l({type:"",message:""}),N.sendMessage({message:"Hello, how are you?",userIdentifier:"alexanderd8980",accessToken:r==null?void 0:r.accessToken}).then(x=>{console.log(x)}).catch(x=>{console.error("Error sending message:",x),l({type:"error",message:"Failed to send message. Please try again."}),p(!1)})};return i.jsxs("div",{className:"max-w-md mx-auto mt-8 p-6 bg-white rounded-lg shadow-md",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Send Kingschat Message"}),i.jsxs("form",{onSubmit:k,children:[i.jsxs("div",{className:"mb-4",children:[i.jsx(R,{htmlFor:"phoneNumber",value:"Phone Number"}),i.jsx(W,{id:"phoneNumber",type:"text",value:a,onChange:m=>e(m.target.value),className:"mt-1 block w-full",required:!0,placeholder:"Enter phone number"})]}),i.jsxs("div",{className:"mb-4",children:[i.jsx(R,{htmlFor:"message",value:"Message"}),i.jsx("textarea",{id:"message",value:n,onChange:m=>t(m.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50",rows:4,required:!0,placeholder:"Enter your message"})]}),c.message&&i.jsx("div",{className:`mb-4 p-3 rounded ${c.type==="success"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:c.message}),i.jsx(C,{type:"submit",disabled:s,children:s?"Sending...":"Send Message"}),i.jsx("a",{className:"kc-web-sdk-btn",onClick:o})]})]})};function re(){const[r,o]=E.useState(null),n=async()=>{const t=await N.login({clientId:"3d6ff64c-7b41-4b8d-a92c-bb51df27222e",scopes:["send_chat_message"]});o(t)};return i.jsxs(U,{header:i.jsx("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:"Dashboard"}),children:[i.jsx(L,{title:"Dashboard"}),i.jsx("div",{className:"py-12",children:i.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:i.jsx("div",{className:"overflow-hidden bg-white shadow-sm sm:rounded-lg",children:i.jsx(J,{loginData:r,loginWithKingsChat:n})})})})]})}export{re as default};
